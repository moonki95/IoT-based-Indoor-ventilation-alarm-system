<html>
<head>
<title>IndoorActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6a8759;}
.s3 { color: #808080;}
.s4 { color: #6897bb;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
IndoorActivity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.example.Android</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">android.content.ContentValues</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.os.AsyncTask</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.os.Bundle</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.util.Log</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.TextView</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">androidx.appcompat.app.AppCompatActivity</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.appcompat.widget.Toolbar</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">org.json.JSONArray</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">org.json.JSONException</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">org.json.JSONObject</span><span class="s0">;</span>

<span class="s0">public class </span><span class="s1">IndoorActivity </span><span class="s0">extends </span><span class="s1">AppCompatActivity {</span>
    <span class="s0">private static </span><span class="s1">String IP_ADDRESS = </span><span class="s2">&quot;54.144.159.63&quot;</span><span class="s0">;</span>
    <span class="s0">private static </span><span class="s1">String TAG = </span><span class="s2">&quot;phptest&quot;</span><span class="s0">;</span>

    <span class="s0">private </span><span class="s1">TextView textViewTemp</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">TextView textViewHumid</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">TextView textViewDust</span><span class="s0">;</span>

    <span class="s0">private </span><span class="s1">IndoorAir indoorAir =</span><span class="s0">new </span><span class="s1">IndoorAir()</span><span class="s0">;</span>

    <span class="s1">@Override</span>
    <span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) {</span>
        <span class="s0">super</span><span class="s1">.onCreate(savedInstanceState)</span><span class="s0">;</span>
        <span class="s1">setContentView(R.layout.activity_indoor)</span><span class="s0">;</span>

        <span class="s1">Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar_indoor)</span><span class="s0">;</span>
        <span class="s1">setSupportActionBar(toolbar)</span><span class="s0">;</span>
        <span class="s1">getSupportActionBar().setDisplayHomeAsUpEnabled(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>


        <span class="s1">textViewTemp = (TextView) findViewById(R.id.textView_temp)</span><span class="s0">;</span>
        <span class="s1">textViewHumid = (TextView) findViewById(R.id.textView_humid)</span><span class="s0">;</span>
        <span class="s1">textViewDust = (TextView) findViewById(R.id.textView_dust)</span><span class="s0">;</span>

        <span class="s1">String url=</span><span class="s2">&quot;http://&quot; </span><span class="s1">+ IP_ADDRESS + </span><span class="s2">&quot;/getjson.php&quot;</span><span class="s0">;</span>
        <span class="s1">SelectDatabaseTask task = </span><span class="s0">new </span><span class="s1">SelectDatabaseTask(url</span><span class="s0">, null</span><span class="s1">)</span><span class="s0">;</span>
        <span class="s1">task.execute()</span><span class="s0">;</span>


    <span class="s1">}</span>

    <span class="s0">class </span><span class="s1">SelectDatabaseTask </span><span class="s0">extends </span><span class="s1">AsyncTask&lt;Void</span><span class="s0">, </span><span class="s1">Void</span><span class="s0">, </span><span class="s1">String&gt; {</span>

        <span class="s0">private </span><span class="s1">String url1</span><span class="s0">;</span>
        <span class="s0">private </span><span class="s1">ContentValues values1</span><span class="s0">;</span>
        <span class="s1">String result1</span><span class="s0">; </span><span class="s3">// 요청 결과를 저장할 변수.</span>

        <span class="s0">public </span><span class="s1">SelectDatabaseTask(String url</span><span class="s0">, </span><span class="s1">ContentValues contentValues) {</span>
            <span class="s0">this</span><span class="s1">.url1 = url</span><span class="s0">;</span>
            <span class="s0">this</span><span class="s1">.values1 = contentValues</span><span class="s0">;</span>
        <span class="s1">}</span>

        <span class="s1">@Override</span>
        <span class="s0">protected </span><span class="s1">String doInBackground(Void... params) {</span>
            <span class="s1">RequestHttpURLConnection requestHttpURLConnection = </span><span class="s0">new </span><span class="s1">RequestHttpURLConnection()</span><span class="s0">;</span>
            <span class="s1">result1 = requestHttpURLConnection.request(url1</span><span class="s0">, </span><span class="s1">values1)</span><span class="s0">; </span><span class="s3">// 해당 URL로 부터 결과물을 얻어온다.</span>
            <span class="s0">return </span><span class="s1">result1</span><span class="s0">; </span><span class="s3">// 여기서 당장 실행 X, onPostExcute에서 실행</span>
        <span class="s1">}</span>
        <span class="s1">@Override</span>
        <span class="s0">protected void </span><span class="s1">onPostExecute(String s) {</span>
            <span class="s0">super</span><span class="s1">.onPostExecute(s)</span><span class="s0">;</span>
            <span class="s3">//textViewTemp.setText(s);  // 파서 없이 전체 출력</span>
            <span class="s1">ShowIndoorAirData(s)</span><span class="s0">; </span><span class="s3">// 파서로 전체 출력</span>
        <span class="s1">}</span>
    <span class="s1">}</span>


    <span class="s0">private void </span><span class="s1">ShowIndoorAirData(String mJsonString){</span>

        <span class="s1">String TAG_JSON=</span><span class="s2">&quot;result&quot;</span><span class="s0">;</span>
        <span class="s1">String TAG_TEMP = </span><span class="s2">&quot;temp&quot;</span><span class="s0">;</span>
        <span class="s1">String TAG_HUMID =</span><span class="s2">&quot;humid&quot;</span><span class="s0">;</span>
        <span class="s1">String TAG_DUST=</span><span class="s2">&quot;dust&quot;</span><span class="s0">;</span>
        <span class="s1">String _temp = </span><span class="s0">null;</span>
        <span class="s1">String _humid=</span><span class="s0">null;</span>
        <span class="s1">String _dust=</span><span class="s0">null;</span>


        <span class="s0">try </span><span class="s1">{</span>
            <span class="s1">JSONObject jsonObject = </span><span class="s0">new </span><span class="s1">JSONObject(mJsonString)</span><span class="s0">;</span>
            <span class="s1">JSONArray jsonArray = jsonObject.getJSONArray(TAG_JSON)</span><span class="s0">;</span>
            <span class="s1">JSONObject item = jsonArray.getJSONObject(</span><span class="s4">0</span><span class="s1">)</span><span class="s0">;</span>

            <span class="s1">_temp = item.getString(TAG_TEMP)</span><span class="s0">;</span>
            <span class="s1">_humid = item.getString(TAG_HUMID)</span><span class="s0">;</span>
            <span class="s1">_dust = item.getString(TAG_DUST)</span><span class="s0">;</span>


            <span class="s1">indoorAir.setTemp(_temp)</span><span class="s0">;</span>
            <span class="s1">indoorAir.setHumid(_humid)</span><span class="s0">;</span>
            <span class="s1">indoorAir.setDust(_dust)</span><span class="s0">;</span>

            <span class="s1">textViewTemp.setText(_temp + </span><span class="s2">&quot; °C&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">textViewHumid.setText(_humid + </span><span class="s2">&quot; %&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">textViewDust.setText(_dust + </span><span class="s2">&quot; ㎍/㎥    &quot;</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">} </span><span class="s0">catch </span><span class="s1">(JSONException e) {</span>

            <span class="s1">Log.d(TAG</span><span class="s0">, </span><span class="s2">&quot;showResult : &quot;</span><span class="s0">, </span><span class="s1">e)</span><span class="s0">;</span>
        <span class="s1">}</span>
    <span class="s1">}</span>

    <span class="s3">/*private class GetIndoorAirData extends AsyncTask&lt;String, Void, String&gt; { 
 
        ProgressDialog progressDialog; 
        String errorString = null; 
 
        @Override 
        protected String doInBackground(String... params) { 
 
            String serverURL = params[0]; 
            String postParameters = params[1]; 
 
            try { 
                URL url = new URL(serverURL); 
                HttpURLConnection httpURLConnection = (HttpURLConnection) url.openConnection(); 
 
                httpURLConnection.setReadTimeout(5000); 
                httpURLConnection.setConnectTimeout(5000); 
                httpURLConnection.setRequestMethod(&quot;POST&quot;); 
                httpURLConnection.setDoInput(true); 
                httpURLConnection.connect(); 
 
                OutputStream outputStream = httpURLConnection.getOutputStream(); 
                outputStream.write(postParameters.getBytes(&quot;UTF-8&quot;)); 
                outputStream.flush(); 
                outputStream.close(); 
 
                int responseStatusCode = httpURLConnection.getResponseCode(); 
                Log.d(TAG, &quot;response code - &quot; + responseStatusCode); 
 
                InputStream inputStream; 
                if (responseStatusCode == HttpURLConnection.HTTP_OK) { 
                    inputStream = httpURLConnection.getInputStream(); 
                } else { 
                    inputStream = httpURLConnection.getErrorStream(); 
                } 
 
                InputStreamReader inputStreamReader = new InputStreamReader(inputStream, &quot;UTF-8&quot;); 
                BufferedReader bufferedReader = new BufferedReader(inputStreamReader); 
 
                StringBuilder sb = new StringBuilder(); 
                String line; 
 
                while ((line = bufferedReader.readLine()) != null) { 
                    sb.append(line); 
                } 
 
                bufferedReader.close(); 
 
                return sb.toString().trim(); 
 
            } catch (Exception e) { 
 
                Log.d(TAG, &quot;GetData : Error &quot;, e); 
                errorString = e.toString(); 
 
                return null; 
            } 
        } 
 
        @Override 
        protected void onPostExecute(String result) { 
            super.onPostExecute(result); 
 
            progressDialog.dismiss(); 
 
            Log.d(TAG, &quot;response - &quot; + result); 
 
            if (result == null){ 
 
                textViewTemp.setText(errorString); 
                textViewHumid.setText(errorString); 
                textViewDust.setText(errorString); 
            } 
            else { 
 
                mJsonString = result; 
                ShowIndoorAirData(); 
 
            } 
        } 
 
    }*/</span>
<span class="s1">}</span>
</pre>
</body>
</html>