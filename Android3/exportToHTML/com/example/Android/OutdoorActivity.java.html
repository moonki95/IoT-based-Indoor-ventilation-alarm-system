<html>
<head>
<title>OutdoorActivity.java</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #cc7832;}
.s1 { color: #a9b7c6;}
.s2 { color: #6897bb;}
.s3 { color: #808080;}
.s4 { color: #6a8759;}
</style>
</head>
<body bgcolor="#2b2b2b">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
OutdoorActivity.java</font>
</center></td></tr></table>
<pre><span class="s0">package </span><span class="s1">com.example.Android</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">android.os.AsyncTask</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.os.Bundle</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.view.View</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.AdapterView</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.ArrayAdapter</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.Button</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.Spinner</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">android.widget.TextView</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">androidx.appcompat.app.AppCompatActivity</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">androidx.appcompat.widget.Toolbar</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">org.xmlpull.v1.XmlPullParser</span><span class="s0">;</span>
<span class="s0">import </span><span class="s1">org.xmlpull.v1.XmlPullParserFactory</span><span class="s0">;</span>

<span class="s0">import </span><span class="s1">java.net.URL</span><span class="s0">;</span>

<span class="s0">public class </span><span class="s1">OutdoorActivity </span><span class="s0">extends </span><span class="s1">AppCompatActivity {</span>

    <span class="s0">private </span><span class="s1">Spinner spinnerSido</span><span class="s0">, </span><span class="s1">spinnerGungu</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">ArrayAdapter&lt;String&gt; arrayAdapter</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">String sido</span><span class="s0">, </span><span class="s1">gungu</span><span class="s0">;</span>

    <span class="s0">private </span><span class="s1">TextView textViewSido</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">TextView textViewPm10</span><span class="s0">;</span>
    <span class="s0">private </span><span class="s1">TextView textViewPm25</span><span class="s0">;</span>

    <span class="s0">private </span><span class="s1">OutdoorAir outdoorAir =</span><span class="s0">new </span><span class="s1">OutdoorAir()</span><span class="s0">;</span>

    <span class="s0">private int </span><span class="s1">isApidata=</span><span class="s2">0</span><span class="s0">;</span>

    <span class="s1">URL url=</span><span class="s0">null;</span>

    <span class="s1">@Override</span>
    <span class="s0">protected void </span><span class="s1">onCreate(Bundle savedInstanceState) {</span>
        <span class="s0">super</span><span class="s1">.onCreate(savedInstanceState)</span><span class="s0">;</span>
        <span class="s1">setContentView(R.layout.activity_outdoor)</span><span class="s0">;</span>

        <span class="s1">Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar_outdoor)</span><span class="s0">;</span>
        <span class="s1">setSupportActionBar(toolbar)</span><span class="s0">;</span>
        <span class="s1">getSupportActionBar().setDisplayHomeAsUpEnabled(</span><span class="s0">true</span><span class="s1">)</span><span class="s0">;</span>

        <span class="s1">textViewSido = (TextView) findViewById(R.id.textView_sido)</span><span class="s0">;</span>
        <span class="s1">textViewPm10 = (TextView) findViewById(R.id.textView_pm10)</span><span class="s0">;</span>
        <span class="s1">textViewPm25 = (TextView) findViewById(R.id.textView_pm25)</span><span class="s0">;</span>

        <span class="s1">spinnerSido=(Spinner)findViewById(R.id.spinner_sido)</span><span class="s0">;</span>
        <span class="s1">arrayAdapter = </span><span class="s0">new </span><span class="s1">ArrayAdapter&lt;String&gt;(</span><span class="s0">this, </span><span class="s1">android.R.layout.simple_spinner_item</span><span class="s0">, </span><span class="s1">(String[])getResources().getStringArray(R.array.spinner_region))</span><span class="s0">;</span>
        <span class="s1">arrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)</span><span class="s0">;</span>
        <span class="s1">spinnerSido.setAdapter(arrayAdapter)</span><span class="s0">;</span>

        <span class="s1">spinnerGungu=(Spinner)findViewById(R.id.spinner_gungu)</span><span class="s0">;</span>
        <span class="s1">initAddressSpinner()</span><span class="s0">;</span>


        <span class="s1">Button okBtn = findViewById(R.id.btn_ok)</span><span class="s0">;</span>
        <span class="s1">okBtn.setOnClickListener(</span><span class="s0">new </span><span class="s1">View.OnClickListener(){</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onClick(View v) {</span>


                <span class="s1">sido=spinnerSido.getSelectedItem().toString()</span><span class="s0">;</span>
                <span class="s1">gungu=spinnerGungu.getSelectedItem().toString()</span><span class="s0">;</span>
                <span class="s1">outdoorAir.setSido(sido)</span><span class="s0">;</span>
                <span class="s1">outdoorAir.setGungu(gungu)</span><span class="s0">;</span>

                <span class="s1">GetXMLTask task = </span><span class="s0">new </span><span class="s1">GetXMLTask()</span><span class="s0">;</span>
                <span class="s1">task.execute()</span><span class="s0">;</span>
            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>


    <span class="s1">}</span>

    <span class="s0">private void </span><span class="s1">initAddressSpinner() {</span>
        <span class="s1">spinnerSido.setOnItemSelectedListener(</span><span class="s0">new </span><span class="s1">AdapterView.OnItemSelectedListener() {</span>
            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onItemSelected(AdapterView&lt;?&gt; parent</span><span class="s0">, </span><span class="s1">View view</span><span class="s0">, int </span><span class="s1">position</span><span class="s0">, long </span><span class="s1">id) {</span>
                <span class="s3">// 시군구, 동의 스피너를 초기화한다.</span>
                <span class="s0">switch </span><span class="s1">(position) {</span>
                    <span class="s0">case </span><span class="s2">0</span><span class="s1">:</span>
                        <span class="s1">spinnerGungu.setAdapter(</span><span class="s0">null</span><span class="s1">)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">1</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_seoul)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">2</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_busan)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">3</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_daegu)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">4</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_incheon)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">5</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_gwangju)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">6</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_daejeon)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">7</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_ulsan)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">8</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_gyeonggi)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">9</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_gangwon)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">10</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_chung_buk)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">11</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_chung_nam)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">12</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_jeon_buk)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">13</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_jeon_nam)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">14</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_gyeong_buk)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">15</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_gyeong_nam)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">16</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_jeju)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                    <span class="s0">case </span><span class="s2">17</span><span class="s1">:</span>
                        <span class="s1">setGunguSpinnerAdapterItem(R.array.spinner_region_sejong)</span><span class="s0">;</span>
                        <span class="s0">break;</span>
                <span class="s1">}</span>
            <span class="s1">}</span>

            <span class="s1">@Override</span>
            <span class="s0">public void </span><span class="s1">onNothingSelected(AdapterView&lt;?&gt; parent) {</span>

            <span class="s1">}</span>
        <span class="s1">})</span><span class="s0">;</span>

    <span class="s1">}</span>
    <span class="s0">private void </span><span class="s1">setGunguSpinnerAdapterItem(</span><span class="s0">int </span><span class="s1">array_resource) {</span>
        <span class="s0">if </span><span class="s1">(arrayAdapter != </span><span class="s0">null</span><span class="s1">) {</span>
            <span class="s1">spinnerGungu.setAdapter(</span><span class="s0">null</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">arrayAdapter = </span><span class="s0">null;</span>
        <span class="s1">}</span>

        <span class="s1">arrayAdapter = </span><span class="s0">new </span><span class="s1">ArrayAdapter&lt;String&gt;(</span><span class="s0">this, </span><span class="s1">android.R.layout.simple_spinner_item</span><span class="s0">, </span><span class="s1">(String[])getResources().getStringArray(array_resource))</span><span class="s0">;</span>
        <span class="s1">arrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)</span><span class="s0">;</span>
        <span class="s1">spinnerGungu.setAdapter(arrayAdapter)</span><span class="s0">;</span>
    <span class="s1">}</span>


    <span class="s0">private class </span><span class="s1">GetXMLTask </span><span class="s0">extends </span><span class="s1">AsyncTask&lt;Void</span><span class="s0">, </span><span class="s1">Void</span><span class="s0">, </span><span class="s1">String&gt; {</span>

        <span class="s1">@Override</span>
        <span class="s0">protected </span><span class="s1">String doInBackground(Void... voids) {</span>
            <span class="s1">String url = </span><span class="s4">&quot;http://openapi.airkorea.or.kr/openapi/services/rest/ArpltnInforInqireSvc/getCtprvnMesureSidoLIst?serviceKey=8%2B64ddNqAnHmK8Lx8tI%2Bngxj6dtexb%2FhgwcSwsDjWb%2FbWSgRHUmNk9%2BtkAlqPCFcVb1QiMx49DQfXdMPHnNkzg%3D%3D&amp;numOfRows=40&amp;pageNo=1&amp;sidoName=&quot;</span><span class="s1">+sido+</span><span class="s4">&quot;&amp;searchCondition=DAILY&quot;</span><span class="s0">;</span>
            <span class="s1">XmlPullParserFactory factory</span><span class="s0">;</span>
            <span class="s1">XmlPullParser parser</span><span class="s0">;</span>
            <span class="s1">URL xmlUrl</span><span class="s0">;</span>
            <span class="s1">String returnResult = </span><span class="s4">&quot;&quot;</span><span class="s0">;</span>

            <span class="s1">isApidata=</span><span class="s2">1</span><span class="s0">;</span>
            <span class="s0">boolean </span><span class="s1">isdataTime = </span><span class="s0">false, </span><span class="s1">isCityName = </span><span class="s0">false, </span><span class="s1">ispm10 = </span><span class="s0">false, </span><span class="s1">ispm25 = </span><span class="s0">false;</span>

            <span class="s0">try </span><span class="s1">{</span>
                <span class="s0">int </span><span class="s1">flag = </span><span class="s2">0</span><span class="s0">;</span>
                <span class="s0">int </span><span class="s1">check=</span><span class="s2">0</span><span class="s0">;</span>

                <span class="s1">xmlUrl = </span><span class="s0">new </span><span class="s1">URL(url)</span><span class="s0">;</span>
                <span class="s1">xmlUrl.openConnection().getInputStream()</span><span class="s0">;</span>
                <span class="s1">factory = XmlPullParserFactory.newInstance()</span><span class="s0">;</span>
                <span class="s1">parser = factory.newPullParser()</span><span class="s0">;</span>
                <span class="s1">parser.setInput(xmlUrl.openStream()</span><span class="s0">, </span><span class="s4">&quot;utf-8&quot;</span><span class="s1">)</span><span class="s0">;</span>

                <span class="s0">int </span><span class="s1">eventType = parser.getEventType()</span><span class="s0">;</span>
                <span class="s0">while </span><span class="s1">((eventType != XmlPullParser.END_DOCUMENT) &amp;&amp; check == </span><span class="s2">0</span><span class="s1">) {</span>
                    <span class="s3">//&lt;tag&gt;text&lt;/tag&gt;이므로 startTag뒤에 있는 text를 찾기위한 switch절</span>
                    <span class="s0">switch </span><span class="s1">(eventType) {</span>
                        <span class="s0">case </span><span class="s1">XmlPullParser.START_TAG:  </span><span class="s3">//start tag가 다음 중 하나일 때 flag=true</span>
                            <span class="s0">if </span><span class="s1">(parser.getName().equals(</span><span class="s4">&quot;cityName&quot;</span><span class="s1">)) {</span>
                                <span class="s1">isCityName = </span><span class="s0">true;</span>
                            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parser.getName().equals(</span><span class="s4">&quot;pm10Value&quot;</span><span class="s1">)) {</span>
                                <span class="s1">ispm10 = </span><span class="s0">true;</span>
                            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(parser.getName().equals(</span><span class="s4">&quot;pm25Value&quot;</span><span class="s1">)) {</span>
                                <span class="s1">ispm25 = </span><span class="s0">true;</span>
                            <span class="s1">}</span>
                            <span class="s0">break;</span>

                        <span class="s0">case </span><span class="s1">XmlPullParser.TEXT:</span>
                            <span class="s0">if</span><span class="s1">(isCityName) {</span>
                                <span class="s0">if</span><span class="s1">(parser.getText().equals(gungu)){</span>
                                    <span class="s1">flag=</span><span class="s2">1</span><span class="s0">;</span>
                                <span class="s1">}</span>
                                <span class="s1">isCityName=</span><span class="s0">false;</span>
                            <span class="s1">}</span><span class="s0">else if </span><span class="s1">(ispm10&amp;&amp;flag==</span><span class="s2">1</span><span class="s1">) {</span>
                                <span class="s1">outdoorAir.setPM10(parser.getText())</span><span class="s0">;</span>
                                <span class="s1">ispm10 = </span><span class="s0">false;</span>
                            <span class="s1">} </span><span class="s0">else if </span><span class="s1">(ispm25&amp;&amp;flag==</span><span class="s2">1</span><span class="s1">) {</span>
                                <span class="s1">outdoorAir.setPM25(parser.getText())</span><span class="s0">;</span>
                                <span class="s1">ispm25 = </span><span class="s0">false;</span>
                            <span class="s1">}</span>
                            <span class="s0">break;</span>

                        <span class="s0">case </span><span class="s1">XmlPullParser.END_TAG:</span>
                            <span class="s0">if </span><span class="s1">(parser.getName().equals(</span><span class="s4">&quot;item&quot;</span><span class="s1">)&amp;&amp;flag==</span><span class="s2">1</span><span class="s1">) {</span>
                                <span class="s1">textViewSido.setText(sido+</span><span class="s4">&quot; &quot;</span><span class="s1">+gungu)</span><span class="s0">;</span>
                                <span class="s1">textViewPm10.setText(outdoorAir.getPM10()+</span><span class="s4">&quot; ㎍/㎥        &quot;</span><span class="s1">+ outdoorAir.getPM10Grade())</span><span class="s0">;</span>
                                <span class="s1">textViewPm25.setText(outdoorAir.getPM25()+</span><span class="s4">&quot; ㎍/㎥        &quot;</span><span class="s1">+ outdoorAir.getPM25Grade())</span><span class="s0">;</span>

                                <span class="s1">check = </span><span class="s2">1</span><span class="s0">;</span>
                                <span class="s1">flag=</span><span class="s2">0</span><span class="s0">;</span>

                            <span class="s1">}</span>
                            <span class="s0">break;</span>
                    <span class="s1">}</span>
                    <span class="s1">eventType = parser.next()</span><span class="s0">;</span>
                <span class="s1">}</span>
            <span class="s1">} </span><span class="s0">catch </span><span class="s1">(Exception e) {</span>
                <span class="s1">textViewSido.setText(</span><span class="s4">&quot;에러가 났습니다...&quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">textViewPm10.setText(</span><span class="s4">&quot;에러가 났습니다...&quot;</span><span class="s1">)</span><span class="s0">;</span>
                <span class="s1">textViewPm25.setText(</span><span class="s4">&quot;에러가 났습니다...&quot;</span><span class="s1">)</span><span class="s0">;</span>
            <span class="s1">}</span>
            <span class="s0">return </span><span class="s1">returnResult</span><span class="s0">;</span>
        <span class="s1">}</span>



        <span class="s1">@Override</span>
        <span class="s0">protected void </span><span class="s1">onPostExecute(String result) {</span>

        <span class="s1">}</span>

    <span class="s1">}</span>

<span class="s1">}</span>
</pre>
</body>
</html>